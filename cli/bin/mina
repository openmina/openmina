#!/bin/sh


MINA_IMAGE=${MINA_IMAGE:-openmina/mina-snark-worker-prover:0.0.4}

if [ -z "$NO_LOCAL_MINA_EXE" ]; then
    LOCAL_MINA_EXE="$(dirname $0)/mina.exe"
    [ -x "$LOCAL_MINA_EXE" ] || LOCAL_MINA_EXE=$(which mina.exe)
fi

if [ -z "$NO_LOCAL_MINA_EXE" ] && [ -x "$LOCAL_MINA_EXE" ]; then
    echo "Using $LOCAL_MINA_EXE as a snark worker" >&2
    exec "$LOCAL_MINA_EXE" internal snark-worker-stdio
elif [ -z "$NO_MINA_IMAGE" ]; then
    echo "Using docker with image ${MINA_IMAGE} as a snark worker" >&2
    exec docker run --rm --interactive --sig-proxy=true "$MINA_IMAGE"
fi
