<div class="border-top pl-12 flex-column w-100">
  <div class="f-600 secondary h-xl lh-xl">Ledger Sync</div>
  <div *ngIf="ledgers.stakingEpoch"
       class="group flex-column"
       [ngClass]="ledgers.stakingEpoch.state">
    <div class="fx-row-vert-cent lh-lg h-lg pr-12">
      <ng-container *ngTemplateOutlet="icon; context: { state: ledgers.stakingEpoch.state }"></ng-container>
      <span class="group-title pl-5">Staking ledger</span>
      <span [style.margin-left]="'auto'">
        <ng-container
          *ngTemplateOutlet="ledgerTime; context: { state: ledgers.stakingEpoch.state, time: ledgers.stakingEpoch.totalTime }"></ng-container>
      </span>
    </div>
    <div class="steps flex-column pr-12">
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.stakingEpoch.snarked.fetchHashesStart, ledgers.stakingEpoch.snarked.fetchHashesEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.stakingEpoch.snarked.fetchHashesDuration"
              class="step">Snarked - Fetch hashes</span>
        <span>{{ ledgers.stakingEpoch.snarked.fetchHashesDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.stakingEpoch.snarked.fetchAccountsStart, ledgers.stakingEpoch.snarked.fetchAccountsEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.stakingEpoch.snarked.fetchAccountsDuration"
              class="step">Snarked - Fetch accounts</span>
        <span>{{ ledgers.stakingEpoch.snarked.fetchAccountsDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.stakingEpoch.staged.fetchPartsStart, ledgers.stakingEpoch.staged.fetchPartsEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.stakingEpoch.staged.fetchPartsDuration"
              class="step">Staged - Fetch parts</span>
        <span>{{ ledgers.stakingEpoch.staged.fetchPartsDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.stakingEpoch.staged.reconstructStart, ledgers.stakingEpoch.staged.reconstructEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.stakingEpoch.staged.reconstructDuration"
              class="step">Staged - Reconstruct</span>
        <span>{{ ledgers.stakingEpoch.staged.reconstructDuration | secDuration: secConfig }}</span>
      </div>
    </div>
  </div>
  <div *ngIf="ledgers.nextEpoch"
       class="group flex-column"
       [ngClass]="ledgers.nextEpoch.state">
    <div class="fx-row-vert-cent lh-lg h-lg pr-12">
      <ng-container *ngTemplateOutlet="icon; context: { state: ledgers.nextEpoch.state }"></ng-container>
      <span class="group-title pl-5">Next epoch ledger</span>
      <span [style.margin-left]="'auto'">
        <ng-container
          *ngTemplateOutlet="ledgerTime; context: { state: ledgers.nextEpoch.state, time: ledgers.nextEpoch.totalTime }"></ng-container>
      </span>
    </div>
    <div class="steps flex-column pr-12">
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.nextEpoch.snarked.fetchHashesStart, ledgers.nextEpoch.snarked.fetchHashesEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.nextEpoch.snarked.fetchHashesDuration"
              class="step">Snarked - Fetch hashes</span>
        <span>{{ ledgers.nextEpoch.snarked.fetchHashesDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.nextEpoch.snarked.fetchAccountsStart, ledgers.nextEpoch.snarked.fetchAccountsEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.nextEpoch.snarked.fetchAccountsDuration"
              class="step">Snarked - Fetch accounts</span>
        <span>{{ ledgers.nextEpoch.snarked.fetchAccountsDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.nextEpoch.staged.fetchPartsStart, ledgers.nextEpoch.staged.fetchPartsEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.nextEpoch.staged.fetchPartsDuration"
              class="step">Staged - Fetch parts</span>
        <span>{{ ledgers.nextEpoch.staged.fetchPartsDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.nextEpoch.staged.reconstructStart, ledgers.nextEpoch.staged.reconstructEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.nextEpoch.staged.reconstructDuration"
              class="step">Staged - Reconstruct</span>
        <span>{{ ledgers.nextEpoch.staged.reconstructDuration | secDuration: secConfig }}</span>
      </div>
    </div>
  </div>
  <div *ngIf="ledgers.root"
       class="group flex-column"
       [ngClass]="ledgers.root.state">
    <div class="fx-row-vert-cent lh-lg h-lg pr-12">
      <ng-container *ngTemplateOutlet="icon; context: { state: ledgers.root.state }"></ng-container>
      <span class="group-title pl-5">Ledger at the root of the frontier</span>
      <span [style.margin-left]="'auto'">
        <ng-container
          *ngTemplateOutlet="ledgerTime; context: { state: ledgers.root.state, time: ledgers.root.totalTime }"></ng-container>
      </span>
    </div>
    <div class="steps flex-column pr-12">
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.root.snarked.fetchHashesStart, ledgers.root.snarked.fetchHashesEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.root.snarked.fetchHashesDuration"
              class="step">Snarked - Fetch hashes</span>
        <span>{{ ledgers.root.snarked.fetchHashesDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.root.snarked.fetchAccountsStart, ledgers.root.snarked.fetchAccountsEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.root.snarked.fetchAccountsDuration"
              class="step">Snarked - Fetch accounts</span>
        <span>{{ ledgers.root.snarked.fetchAccountsDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.root.staged.fetchPartsStart, ledgers.root.staged.fetchPartsEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.root.staged.fetchPartsDuration"
              class="step">Staged - Fetch parts</span>
        <span>{{ ledgers.root.staged.fetchPartsDuration | secDuration: secConfig }}</span>
      </div>
      <div class="flex-row flex-between h-lg lh-lg"
           (mouseenter)="show($event, ledgers.root.staged.reconstructStart, ledgers.root.staged.reconstructEnd)"
           (mouseleave)="hide()">
        <span [class.secondary]="ledgers.root.staged.reconstructDuration"
              class="step">Staged - Reconstruct</span>
        <span>{{ ledgers.root.staged.reconstructDuration | secDuration: secConfig }}</span>
      </div>
    </div>
  </div>
</div>

<ng-template #icon let-state="state">
  <ng-container [ngSwitch]="state">
    <ng-container *ngSwitchCase="'pending'">
      <span class="pending-icon fx-col-full-cent">
        <span></span>
      </span>
    </ng-container>
    <ng-container *ngSwitchCase="'loading'">
      <span class="loading-icon mina-icon icon-200 primary">progress_activity</span>
    </ng-container>
    <ng-container *ngSwitchCase="'success'">
      <span class="mina-icon icon-200 success-primary">task_alt</span>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #ledgerTime let-state="state" let-time="time">
  <ng-container [ngSwitch]="state">
    <ng-container *ngSwitchCase="'loading'">
      <span class="mina-icon icon-200 primary mr--5">more_horiz</span>
    </ng-container>
    <ng-container *ngSwitchCase="'success'">
      <span class="primary">{{ time | secDuration: secConfig }}</span>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #tooltipRef let-start="start" let-end="end">
  <div class="bg-surface-top popup-box-shadow-weak border pl-10 pr-10 pt-5 pb-5 border-rad-6">
    <div class="tooltip-row tertiary lh-sm h-sm">
      Start:
      <span class="primary">{{ start | readableDate }}</span>
    </div>
    <div class="tooltip-row tertiary lh-sm h-sm">
      End:
      <span class="primary">{{ end | readableDate }}</span>
    </div>
  </div>
</ng-template>