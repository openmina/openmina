"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[778],{5778:(ot,Z,c)=>{c.r(Z),c.d(Z,{TestingToolScenariosModule:()=>it});var b=c(107),T=c(4348),a=c(6310),f=c(5301);const U=(0,f.ZF)("testingTool"),E=(0,f.P1)(U,n=>n.scenarios),h=n=>(0,f.P1)(E,n),_=h(n=>n.scenario),O=h(n=>n.pendingEvents),F=h(n=>n.clusterId),A=h(n=>n.scenarioIsRunning),$=h(n=>n.scenarioHasRun);var R=c(553),S=c(5333),w=c(153),t=c(755),v=c(4430),N=c(8239),W=c(3986),x=c(6733);function G(n,u){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA(),t.TgZ(2,"span",2)(3,"span",3),t._uU(4,"check"),t.qZA()(),t.TgZ(5,"span",4),t._uU(6),t.qZA(),t.TgZ(7,"span"),t._uU(8),t.qZA(),t.TgZ(9,"span",5),t._uU(10),t.ALo(11,"json"),t.qZA()),2&n){const e=u.row;let s;t.xp6(1),t.Oqu(e.index+1),t.xp6(5),t.Oqu(e.kind),t.xp6(2),t.Oqu(null!==(s=e.dialer)&&void 0!==s?s:"-"),t.xp6(2),t.Oqu(t.lcZ(11,4,e.listener||e.event))}}let J=(()=>{class n extends W.B{constructor(){super(...arguments),this.tableHeads=[{name:""},{name:""},{name:"kind"},{name:"dialer"},{name:"data"}]}ngOnInit(){var e=()=>super.ngOnInit,s=this;return(0,N.Z)(function*(){yield e().call(s),s.listenToScenariosChanges()})()}setupTable(){this.table.gridTemplateColumns=[30,30,110,90,"1fr"],this.table.minWidth=500}listenToScenariosChanges(){this.select(_,e=>{this.table.rows=e.steps,this.table.detect(),this.detect()},(0,S.h)(Boolean))}onRowClick(e){}static#t=this.\u0275fac=function(){let e;return function(o){return(e||(e=t.n5z(n)))(o||n)}}();static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["mina-scenarios-steps-table"]],hostAttrs:[1,"flex-column"],features:[t.qOj],decls:4,vars:0,consts:[["minaTable",""],["rowTemplate",""],[1,"fx-row-vert-cent"],[1,"mina-icon"],[1,"secondary"],[1,"truncate"]],template:function(s,o){1&s&&(t.GkF(0,null,0),t.YNc(2,G,12,6,"ng-template",null,1,t.W1O))},dependencies:[x.Ts],styles:["[_nghost-%COMP%]     .row{background-color:unset!important}"],changeDetection:0})}return n})();var y=c(4776);function M(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"div",6)(1,"span",7),t._uU(2),t.qZA(),t.TgZ(3,"span")(4,"span",8),t._uU(5),t.qZA()(),t.TgZ(6,"div",9)(7,"span",10),t._uU(8),t.qZA(),t.TgZ(9,"span",11),t._uU(10),t.qZA()(),t.TgZ(11,"span",12)(12,"button",13),t.NdJ("click",function(){const i=t.CHM(e).$implicit,p=t.oxw(2);return t.KtG(p.addEventToSteps(i))}),t.TgZ(13,"span",14),t._uU(14,"add"),t.qZA()()()()}if(2&n){const e=u.$implicit;t.xp6(2),t.hij("Node ",e.node_id,""),t.xp6(3),t.Oqu(e.id),t.xp6(3),t.Oqu(e.event),t.xp6(2),t.Oqu(e.details||"-"),t.xp6(2),t.Q6J("tooltip","Add to steps and run the scenario")}}function q(n,u){if(1&n&&(t.ynx(0),t.YNc(1,M,15,5,"div",5),t.BQk()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.events)("ngForTrackBy",e.eventsTrackBy)}}function B(n,u){if(1&n&&(t.TgZ(0,"div",11),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.scenarioIsRunning?"Pending events...":"No events")}}let P=(()=>{class n extends T.T{constructor(){super(),this.scenarioIsRunning=!1,this.eventsTrackBy=(e,s)=>s.id+s.details}ngOnInit(){this.listenToEvents(),this.listenToRunningScenario()}addEventToSteps(e){this.dispatch(a.xc,{runScenario:!0,step:{kind:"Event",node_id:e.node_id,event:e.event}})}listenToEvents(){this.select(O,e=>{this.events=e,this.detect()})}listenToRunningScenario(){this.select(A,e=>{this.scenarioIsRunning=e,this.detect()},(0,y.T)(1))}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["mina-scenarios-event-traces-table"]],hostAttrs:[1,"flex-column","h-100"],features:[t.qOj],decls:7,vars:2,consts:[[1,"fx-row-vert-cent","flex-between","h-xl","lh-xl","pl-12","pr-12"],[1,"f-600","secondary"],[1,"h-minus-xl","flex-column","pl-12","pr-12","overflow-y-auto"],[4,"ngIf","ngIfElse"],["noEvents",""],["class","flex-row border border-rad-6 p-10 mb-10",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex-row","border","border-rad-6","p-10","mb-10"],[1,"node","tertiary"],[1,"bg-container","border-rad-4","p-5","mr-10"],[1,"event","flex-column"],[1,"truncate","secondary"],[1,"tertiary"],[1,"add","fx-row-vert-cent","flex-end"],[1,"icon-button",3,"tooltip","click"],[1,"mina-icon"]],template:function(s,o){if(1&s&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2,"Event traces"),t.qZA()(),t.TgZ(3,"div",2),t.YNc(4,q,2,2,"ng-container",3),t.YNc(5,B,2,1,"ng-template",null,4,t.W1O),t.qZA()),2&s){const i=t.MAs(6);t.xp6(4),t.Q6J("ngIf",o.events.length)("ngIfElse",i)}},dependencies:[x.sg,x.O5,v.MinaTooltipDirective],styles:[".event[_ngcontent-%COMP%]{max-width:50%}.add[_ngcontent-%COMP%]{margin-left:auto}.node[_ngcontent-%COMP%]{width:70px}"],changeDetection:0})}return n})(),z=(()=>{class n extends T.T{constructor(){super(),this.scenarioIsRunning=!1}ngOnInit(){this.listenToRunningScenario(),this.listenToScenario(),this.listenToCluster()}runSteps(){this.dispatch(this.clusterId?a.EP:a.Vs)}listenToRunningScenario(){this.select(A,e=>{this.scenarioIsRunning=e,this.detect()},(0,y.T)(1))}listenToScenario(){this.select(_,e=>{this.scenario=e,this.detect()},(0,y.T)(1))}listenToCluster(){this.select(F,e=>{this.clusterId=e})}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["mina-scenarios-steps-toolbar"]],hostAttrs:[1,"fx-row-vert-cent","h-xl","pl-12"],features:[t.qOj],decls:4,vars:3,consts:[[1,"f-600"],[1,"btn-primary","ml-10","mr-10",3,"disabled","click"]],template:function(s,o){1&s&&(t.TgZ(0,"div",0),t._uU(1),t.qZA(),t.TgZ(2,"button",1),t.NdJ("click",function(){return o.runSteps()}),t._uU(3),t.qZA()),2&s&&(t.xp6(1),t.Oqu(null==o.scenario?null:o.scenario.info.description),t.xp6(1),t.Q6J("disabled",o.scenarioIsRunning),t.xp6(1),t.hij(" ",o.scenarioIsRunning?"Running...":"Run Steps","\n"))},changeDetection:0})}return n})();var C=c(3226);let j=(()=>{class n{constructor(){this.cancel=new t.vpe,this.confirm=new t.vpe}static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["mina-scenarios-add-step"]],inputs:{currentStep:"currentStep"},outputs:{cancel:"cancel",confirm:"confirm"},decls:9,vars:2,consts:[[1,"bg-container","border-rad-6","p-10"],[1,"mb-10","f-600"],["type","text",1,"w-100","border-rad-6","mina-input","mb-10",3,"ngModel","ngModelChange"],[1,"flex-row","flex-between","align-center"],[1,"btn-primary",3,"click"],[1,"btn-cta",3,"click"]],template:function(s,o){1&s&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.qZA(),t.TgZ(3,"input",2),t.NdJ("ngModelChange",function(p){return o.pastedText=p}),t.qZA(),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return o.cancel.emit()}),t._uU(6,"Cancel"),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return o.confirm.emit(o.pastedText)}),t._uU(8,"Confirm Step"),t.qZA()()()),2&s&&(t.xp6(2),t.hij("Add Step ",o.currentStep+1,""),t.xp6(1),t.Q6J("ngModel",o.pastedText))},dependencies:[C.Fj,C.JJ,C.On],changeDetection:0})}return n})();function Q(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"mina-scenarios-add-step",3),t.NdJ("cancel",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.stepIsAdding=!1)})("confirm",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.addStep(o))}),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("currentStep",e.stepCount+1)}}let Y=(()=>{class n extends T.T{constructor(){super(...arguments),this.stepIsAdding=!1,this.stepCount=0}ngOnInit(){this.listenToStepCount()}addStep(e){this.dispatch(a.xc,{runScenario:!0,step:JSON.parse(e)}),this.stepIsAdding=!1}listenToStepCount(){this.select(_,e=>{this.stepCount=e.steps.length},(0,S.h)(Boolean))}static#t=this.\u0275fac=function(){let e;return function(o){return(e||(e=t.n5z(n)))(o||n)}}();static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["mina-scenarios-steps-footer"]],hostAttrs:[1,"flex-column","p-12"],features:[t.qOj],decls:4,vars:2,consts:[[1,"flex-row"],[1,"btn-primary",3,"disabled","click"],[3,"currentStep","cancel","confirm",4,"ngIf"],[3,"currentStep","cancel","confirm"]],template:function(s,o){1&s&&(t.TgZ(0,"div",0)(1,"button",1),t.NdJ("click",function(){return o.stepIsAdding=!o.stepIsAdding}),t._uU(2,"Add Step "),t.qZA()(),t.YNc(3,Q,1,1,"mina-scenarios-add-step",2)),2&s&&(t.xp6(1),t.Q6J("disabled",o.stepIsAdding),t.xp6(2),t.Q6J("ngIf",o.stepIsAdding))},dependencies:[x.O5,j],changeDetection:0})}return n})();function D(n,u){1&n&&(t.TgZ(0,"div",3),t._UZ(1,"mina-scenarios-steps-toolbar")(2,"mina-scenarios-steps-table",4)(3,"mina-scenarios-steps-footer"),t.qZA())}function k(n,u){1&n&&t._UZ(0,"mina-scenarios-event-traces-table")}const H=[{path:"",component:(()=>{class n extends T.T{constructor(e){super(),this.el=e,this.hasRun=!1}ngOnInit(){this.dispatch(a.NL),this.listenToScenario(),this.getPendingEvents()}listenToScenario(){this.select($,e=>{console.log("hasRun",e),this.hasRun=e})}getPendingEvents(){(0,R.H)(0,3e3).pipe((0,w.t)(this),(0,S.h)(()=>this.hasRun)).subscribe(()=>{this.dispatch(a.ly)})}ngOnDestroy(){super.ngOnDestroy(),this.dispatch(a.Q9)}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(t.SBq))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["mina-testing-tool-scenarios"]],features:[t.qOj],decls:5,vars:5,consts:[["localStorageKey","tt-scenarios-spw",3,"leftTemplate","rightTemplate","show","minWidth","maxWidthElement"],["left",""],["right",""],[1,"h-100","flex-column"],[1,"flex-grow"]],template:function(s,o){if(1&s&&(t._UZ(0,"mina-horizontal-resizable-container",0),t.YNc(1,D,4,0,"ng-template",null,1,t.W1O),t.YNc(3,k,1,0,"ng-template",null,2,t.W1O)),2&s){const i=t.MAs(2),p=t.MAs(4);t.Q6J("leftTemplate",i)("rightTemplate",p)("show",!0)("minWidth",600)("maxWidthElement",o.el.nativeElement)}},dependencies:[v.HorizontalResizableContainerComponent,J,P,z,Y],changeDetection:0})}return n})()}];let X=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[b.Bz.forChild(H),b.Bz]})}return n})();var L=c(6208),r=c(2223),K=c(8899),d=c(4787),V=c(453),l=c(2425),m=c(8377),g=c(9841),tt=c(7020),et=c(2939);let nt=(()=>{class n{constructor(e){this.http=e,this.baseUrl="http://65.109.110.75:11000"}getScenario(){return this.http.get(this.baseUrl+"/scenarios").pipe((0,l.U)(e=>e[0].id),(0,d.w)(e=>this.getScenarioWithId(e)))}getScenarioWithId(e){return this.http.get(`${this.baseUrl}/scenarios/${e}`).pipe((0,l.U)(s=>({...s,steps:s.steps.map((o,i)=>({...o,index:i}))})))}reloadScenario(e,s){return this.http.post(`${this.baseUrl}/clusters/${e}/scenarios/reload`,null).pipe((0,d.w)(()=>this.getScenarioWithId(s)))}addStep(e,s){return this.http.put(`${this.baseUrl}/scenarios/${e}/steps`,s)}createCluster(e){return this.http.put(`${this.baseUrl}/clusters/create/${e}`,null).pipe((0,l.U)(s=>s.cluster_id))}startScenario(e){return this.http.post(`${this.baseUrl}/clusters/${e}/run`,null)}getPendingEvents(e){return this.http.get(`${this.baseUrl}/clusters/${e}/nodes/events/pending`).pipe((0,l.U)(s=>s.reduce((o,i)=>[...o,...i.pending_events.map(p=>({...p,node_id:i.node_id}))],[])))}static#t=this.\u0275fac=function(s){return new(s||n)(t.LFG(et.eN))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),st=(()=>{class n extends tt.D{constructor(e,s,o){super(o,K.uC),this.actions$=e,this.testingToolScenariosService=s,this.getScenario$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.zb,a._l),this.latestActionState(),(0,d.w)(({action:i})=>i.type===a._l?V.E:this.testingToolScenariosService.getScenario()),(0,l.U)(i=>({type:a.mx,payload:i})),(0,m._E)(g.Z.GENERIC,a.mx,{}))),this.addStep$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.r6),this.latestActionState(),(0,d.w)(({action:i,state:p})=>this.testingToolScenariosService.addStep(p.testingTool.scenarios.scenario.info.id,i.payload.step)),(0,l.U)(()=>({type:a.yZ})),(0,m._E)(g.Z.GENERIC,null))),this.reloadScenario$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.yZ),this.latestActionState(),(0,d.w)(({state:i})=>this.testingToolScenariosService.reloadScenario(i.testingTool.scenarios.clusterId,i.testingTool.scenarios.scenario.info.id)),(0,l.U)(i=>({type:a.mx,payload:i})),(0,m._E)(g.Z.GENERIC,a.mx,{}))),this.reloadScenarioSuccess$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.mx),this.latestActionState(),(0,S.h)(({state:i})=>i.testingTool.scenarios.runScenario),(0,l.U)(()=>({type:a.NW})))),this.createCluster$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.CS),this.latestActionState(),(0,d.w)(({state:p})=>this.testingToolScenariosService.createCluster(p.testingTool.scenarios.scenario.info.id)),(0,l.U)(i=>({type:a.Uq,payload:i})),(0,m._E)(g.Z.GENERIC,a.Uq))),this.createClusterSuccess$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.Uq),(0,l.U)(()=>({type:a.NW})))),this.startScenario$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.NW),this.latestActionState(),(0,d.w)(({state:i})=>this.testingToolScenariosService.startScenario(i.testingTool.scenarios.clusterId)),(0,l.U)(()=>({type:a.TF})),(0,m._E)(g.Z.GENERIC,a.TF))),this.startScenarioSuccess$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.TF),(0,l.U)(()=>({type:a.mb})))),this.getPendingEvents$=(0,r.GW)(()=>this.actions$.pipe((0,r.l4)(a.mb),this.latestActionState(),(0,d.w)(({state:i})=>this.testingToolScenariosService.getPendingEvents(i.testingTool.scenarios.clusterId)),(0,l.U)(i=>({type:a.YR,payload:i}))))}static#t=this.\u0275fac=function(s){return new(s||n)(t.LFG(r.eX),t.LFG(nt),t.LFG(f.yh))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),it=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[X,L.m,v.HorizontalResizableContainerComponent,v.CopyComponent,r.sQ.forFeature(st),C.u5]})}return n})()}}]);